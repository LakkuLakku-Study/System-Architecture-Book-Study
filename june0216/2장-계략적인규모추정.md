# 2의 제곱수

- 분산 시스템에서 다루는 데이터의 양에 대한 제대로 된 계산 결과를 얻기 → 데이터 볼륨의 단위가 2의 제곱수로 어떻게 표현되는지 알기
- 최소 단위는 1바이트이고. 8비트로 구성된다.
- ASCII 문자 하나가 차지하는 메모리의 크기는 1바이트이다.
- 흔히 쓰이는 데이터 볼륨 단위

| 2의 X제곱 | 근사치 | 이름 | 축약형 |
| --- | --- | --- | --- |
| 10 | 1천 | 1킬로바이트 | 1KB |
| 20 | 1백만 | 1메가바이트 | 1MB |
| 30 | 10억 | 1기가바이트 | 1GB |
| 40 | 1조 | 1테라바이트 | 1TB |
| 50 | 1000조 | 1페타바이트 | 1PB |

# 모든 프로그래머가 알아야하는 응답 지연 값

| 연산명 | 시간 |
| --- | --- |
| L1 캐시 참조 | 0.5ns |
| 분기 예측 오류 | 5ns |
| L2 캐시 참조 | 7ns |
| 뮤텍스 락/언락 | 100ns |
| 주 메모리 참조 | 100ns |
| Zippy로 1KB 압축 | 10,000ns = 10us |
| 1Gbps 네트워크로 2KB 전송 | 20,000ns = 20us |
| 메모리에서 1MB 순차적으로 read | 250,000ns = 250us |
| 디스크 탐색 | 10,000,000ns = 10ms |
| 네트워크에서 1MB 순차적으로 read | 10ms |
| 디스크에서 1MB 순차적으로 read | 30ms |
| 한 패킷의 캘리포니아로부터 네델란드까지의 왕복 지연시간 | 150ms |
- 메모리는 빠르지만 디스크는 아직도 느리다.
- 디스크 탐색은 가능한 피하라.
- 단순한 압축 알고리즘은 빠르다.
- 데이터를 인터넷으로 전송하기 전에 가능하면 압축하라.
- 데이터 센터는 보통 여러 지역에 분산되어 있고 센터들 간에 데이터를 주고받는 데는 시간이 걸린다.

# 가용성에 관계된 수치들

- 고가용성 = 시스템이 오랜 시간동안 지속적으로 중단없이 운영되는 능력
    - 고가용성 100% → 시스템이 한 번도 중단된 적이 없음을 의미
    - 대부분 서비스는 100% ~99% 사이의 값을 갖는다.
- `SLA(Service Level Agreement)`는 서비스 사업자(Service Provider)와 고객 사이에 맺어진 합의
- 가용률에 따른 시스템 장애 시간
    
    ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/e2c6ccd4-4439-43db-96e9-e654aaf4aa71/2fd7b2f8-5db4-4b45-97da-32348ad38ddd/Untitled.png)
    

# **예제: 트위터 QPS 와 저장소 요구량 추정**

### 가정

- MAU(월간 능동 사용자) : 300,000,000 (3억명)
- 그 중 50% 사용자가 매일 사용
- 평균적으로 각 사용자는 매일 2건의 트윗을 작성
- 미디어를 포함하는 트윗은 10%정도임
- 데이터는 5년간 보관

### 추정

**QPS 추정치 (데이터 베이스 서버가 1초에 처리할 수 있는 쿼리 수를 나타내는 수, Query Per Second)**

- DAU(일간 사용자)  = 300,000,000 * 50% = 150,000,000 (1.5억)
- QPS = 150,000,000 * 2(tweet)/24(hour)/3600(second) = 3472.2 (약 3500)
- 최대 QPS(Peek QPS) =  2 * QPS = 6944 (약 7000)

**미디어 저장을 위한 저장소 요구량**

- 평균 트윗 크기
    - tweet_id : 64 Byte
    - text : 140 Byte
    - Media : 1MB
- 미디어 저장소 요구량 : 150,000,000 *  *2 * 10% **  1MB = 30TB / 일
- 5년간 미디어 보관하기 위한 저장소 요구량 : 30TB* *365 ** 5 = 약 55 PB

# 팁

계략적인 규모 추정과 관련된 면접에서 결과를 내는 것보다 올바른 절차를 밟느냐가 중요하다.

- 적절한 근사치를 활용하여 시간을 절약하라.
- 가정들을 적어 두라
- 단위를 붙이는 습관을 들이기 → 모호함을 방지하자
- 많이 출제되는 개략적 규모 추정 문제는 QPS, 최대 QPS, 저장소 요구량, 캐시 요구량, 서버 수 등을 추정하는 것이다.
